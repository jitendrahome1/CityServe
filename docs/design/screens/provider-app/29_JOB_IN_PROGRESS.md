# Job In Progress

## Overview
- **Screen ID**: 29
- **Screen Name**: Job In Progress (Active Service)
- **User Flow**: Manage ongoing job, update status, complete job
- **Navigation**: From Active Jobs "Start Job" button

## ASCII Wireframe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  Service In Progress            â€¢â€¢â€¢   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  â±ï¸ 00:45:32                             â”‚ â† Timer (auto)
â”‚  Started at 2:00 PM                      â”‚
â”‚                                          â”‚
â”‚  ğŸ”§ AC Repair & Service                  â”‚
â”‚  #BK789012                               â”‚
â”‚                                          â”‚
â”‚  ğŸ‘¤ Customer: Amit Kumar                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [Photo] â­ 4.5                      â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ [ğŸ“ Call Customer] [ğŸ’¬ Message]    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  ğŸ“ 123 MG Road, HSR Layout              â”‚
â”‚                                          â”‚
â”‚  ğŸ“ Service Progress                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ… Arrived at location              â”‚ â”‚ â† Timeline
â”‚  â”‚    2:05 PM                         â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ âœ… Started diagnosis                â”‚ â”‚
â”‚  â”‚    2:10 PM                         â”‚ â”‚
â”‚  â”‚    Issue: Low gas, compressor OK   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ â³ Gas refilling in progress        â”‚ â”‚
â”‚  â”‚    Started at 2:30 PM              â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚ â”‚ + Add Update                   â”‚â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  ğŸ“¸ Service Photos                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [Photo1] [Photo2]        [+ Add]   â”‚ â”‚ â† Photo Gallery
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  ğŸ’° Charges                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Base Service:            â‚¹550      â”‚ â”‚
â”‚  â”‚ Gas Refill (Extra):      â‚¹300      â”‚ â”‚ â† Additional
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚ â”‚
â”‚  â”‚ Total:                   â‚¹850      â”‚ â”‚
â”‚  â”‚ Your Earnings (85%):     â‚¹722      â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ [+ Add Extra Charges]              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  âœ… Service completed successfully?     â”‚ â† Checklist
â”‚  â˜‘ï¸ Customer satisfied                  â”‚
â”‚  â˜‘ï¸ Area cleaned                        â”‚
â”‚  â˜‘ï¸ Photos uploaded                     â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Mark as Complete                  â”‚ â”‚ â† Complete CTA
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚         Report Issue                     â”‚ â† Issue Link
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Features

### Auto Timer
- Starts when job begins
- Tracks total service time
- Displays elapsed time (HH:MM:SS)
- Used for analytics and performance

### Service Progress Timeline
- Chronological updates
- Provider adds status updates
- Timestamps auto-added
- Customer can view in real-time

**Update Types**:
- Arrived
- Started diagnosis
- Issue identified
- Work in progress
- Testing
- Completed

### Photo Documentation
- Before/after photos
- Issue documentation
- Completed work proof
- Customer approval

**Photo Features**:
- Camera or gallery
- Max 6 photos per job
- Auto-compress
- Upload to cloud

### Additional Charges
- Add extra items/services
- Must explain reason
- Customer approval required (for high amounts)
- Transparent breakdown

**Common Extras**:
- Parts/materials used
- Additional services
- Travel charges (if applicable)

### Completion Checklist
```swift
struct CompletionChecklist: View {
    @State private var serviceDone = false
    @State private var customerSatisfied = false
    @State private var areaCleaned = false
    @State private var photosUploaded = false

    var canComplete: Bool {
        serviceDone && customerSatisfied && areaCleaned && photosUploaded
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 12) {
            CheckboxItem(
                "Service completed successfully",
                isChecked: $serviceDone
            )
            CheckboxItem(
                "Customer satisfied",
                isChecked: $customerSatisfied
            )
            CheckboxItem(
                "Work area cleaned",
                isChecked: $areaCleaned
            )
            CheckboxItem(
                "Photos uploaded",
                isChecked: $photosUploaded
            )
        }

        PrimaryButton(
            title: "Mark as Complete",
            action: completeJob,
            isDisabled: !canComplete
        )
    }
}
```

## Interactions

### Add Update
```swift
func addUpdate() {
    presentSheet(AddUpdateSheet(
        updateTypes: [
            .arrived, .diagnosis, .issueFound,
            .workInProgress, .testing, .completed
        ],
        onSubmit: { type, notes in
            Task {
                await viewModel.addUpdate(type: type, notes: notes)
            }
        }
    ))
}
```

### Add Photo
```swift
func addPhoto() {
    presentSheet(PhotoPickerSheet(
        maxPhotos: 6,
        currentCount: viewModel.photos.count,
        onPhotoSelected: { image in
            Task {
                await viewModel.uploadPhoto(image)
            }
        }
    ))
}
```

### Add Extra Charges
```swift
func addExtraCharges() {
    presentSheet(ExtraChargesSheet(
        onSubmit: { item, amount, reason in
            Task {
                let approved = await viewModel.addExtraCharge(
                    item: item,
                    amount: amount,
                    reason: reason
                )

                if approved {
                    ToastManager.show("Charge added")
                } else {
                    AlertManager.show(
                        title: "Customer Approval Needed",
                        message: "Customer will be notified. Proceed only after approval."
                    )
                }
            }
        }
    ))
}
```

### Mark as Complete
```swift
func completeJob() {
    guard canComplete else { return }

    AlertManager.show(
        title: "Complete Job?",
        message: "Confirm that service is completed and customer is satisfied.",
        primaryButton: "Mark Complete",
        primaryAction: {
            Task {
                let success = await viewModel.completeJob()
                if success {
                    showCompletionSuccess()
                }
            }
        }
    )
}

func showCompletionSuccess() {
    // Show success screen
    let successView = JobCompletedSuccessView(
        jobId: viewModel.job.id,
        earnings: viewModel.totalEarnings,
        onDone: {
            navigationController?.popToRoot()
        }
    )
    presentFullScreen(successView)
}
```

### Report Issue
- Show issue types:
  - Customer not available
  - Wrong address
  - Customer cancelled
  - Parts not available
  - Safety concern
  - Other

- Submit report
- Contact support automatically
- Handle appropriately

## Real-time Features

### Customer Can View
- Service progress updates
- Photos uploaded
- Estimated completion time
- Additional charges (for approval)

### Provider Updates
- Customer messages
- Approval for extra charges
- Rating/feedback (after completion)

## Completion Flow

1. **Provider clicks "Mark Complete"**
2. **Validation**: All checklist items checked
3. **Confirmation**: Alert with summary
4. **API Call**: Update job status
5. **Notify Customer**: Service completed
6. **Success Screen**: Shows earnings, asks for feedback
7. **Navigate**: Back to dashboard or active jobs

## Success Screen (After Completion)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          â”‚
â”‚         âœ…                               â”‚
â”‚                                          â”‚
â”‚  Job Completed!                          â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  You Earned:  â‚¹722                 â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚  Service time: 1h 45min            â”‚ â”‚
â”‚  â”‚  Customer: Amit Kumar              â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚  Payment will be transferred       â”‚ â”‚
â”‚  â”‚  within 24 hours                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  â­ Rate Your Experience                â”‚
â”‚  â˜…â˜…â˜…â˜…â˜…                                  â”‚
â”‚                                          â”‚
â”‚  [Submit Feedback]                       â”‚
â”‚                                          â”‚
â”‚  [View Next Job]  [Back to Dashboard]   â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Analytics
- `job_started`: Timer started
- `service_update_added`: Progress update
- `photo_uploaded`: Documentation
- `extra_charge_added`: Additional amount
- `job_completed`: Service finished
- `completion_time`: Duration tracked
- `customer_rating_received`: Feedback

## Testing
- âœ… Timer accuracy
- âœ… Update timeline order
- âœ… Photo upload/compression
- âœ… Extra charges calculation
- âœ… Checklist validation
- âœ… Complete button state
- âœ… Real-time sync
- âœ… Network error handling
- âœ… App background/foreground
